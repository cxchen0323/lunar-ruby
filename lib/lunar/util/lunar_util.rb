module Lunar
  class LunarUtil
    BASE_MONTH_ZHI_INDEX = 2
    XUN = %w[甲子 甲戌 甲申 甲午 甲辰 甲寅].freeze
    XUN_KONG = %w[戌亥 申酉 午未 辰巳 寅卯 子丑].freeze
    LIU_YAO = %w[先胜 友引 先负 佛灭 大安 赤口].freeze
    HOU = %w[初候 二候 三候].freeze
    WU_HOU = %w[蚯蚓结 麋角解 水泉动 雁北乡 鹊始巢 雉始雊 鸡始乳 征鸟厉疾 水泽腹坚 东风解冻 蛰虫始振 鱼陟负冰 獭祭鱼 候雁北 草木萌动 桃始华 仓庚鸣 鹰化为鸠 玄鸟至 雷乃发声 始电 桐始华 田鼠化为鴽 虹始见 萍始生 鸣鸠拂奇羽 戴胜降于桑 蝼蝈鸣 蚯蚓出 王瓜生 苦菜秀 靡草死 麦秋至 螳螂生 鵙始鸣 反舌无声 鹿角解 蜩始鸣 半夏生 温风至 蟋蟀居壁 鹰始挚 腐草为萤 土润溽暑 大雨行时 凉风至 白露降 寒蝉鸣 鹰乃祭鸟 天地始肃 禾乃登 鸿雁来 玄鸟归 群鸟养羞 雷始收声 蛰虫坯户 水始涸 鸿雁来宾 雀入大水为蛤 菊有黄花 豺乃祭兽 草木黄落 蛰虫咸俯 水始冰 地始冻 雉入大水为蜃 虹藏不见 天气上升地气下降 闭塞而成冬 鹖鴠不鸣 虎始交 荔挺出].freeze
    GAN = ['', '甲', '乙', '丙', '丁', '戊', '己', '庚', '辛', '壬', '癸'].freeze
    POSITION_XI = ['', '艮', '乾', '坤', '离', '巽', '艮', '乾', '坤', '离', '巽'].freeze
    POSITION_YANG_GUI = ['', '坤', '坤', '兑', '乾', '艮', '坎', '离', '艮', '震', '巽'].freeze
    POSITION_YIN_GUI = ['', '艮', '坎', '乾', '兑', '坤', '坤', '艮', '离', '巽', '震'].freeze
    POSITION_FU = ['', '巽', '巽', '震', '震', '坎', '离', '坤', '坤', '乾', '兑'].freeze
    POSITION_FU_2 = ['', '坎', '坤', '乾', '巽', '艮', '坎', '坤', '乾', '巽', '艮'].freeze
    POSITION_CAI = ['', '艮', '艮', '坤', '坤', '坎', '坎', '震', '震', '离', '离'].freeze
    POSITION_TAI_SUI_YEAR = %w[坎 艮 艮 震 巽 巽 离 坤 坤 兑 坎 坎].freeze
    POSITION_GAN = %w[震 震 离 离 中 中 兑 兑 坎 坎].freeze
    POSITION_ZHI = %w[坎 中 震 震 中 离 离 中 兑 兑 中 坎].freeze
    POSITION_TAI_DAY = [
      '占门碓 外东南', '碓磨厕 外东南', '厨灶炉 外正南',
      '门鸡栖 外西南', '占大门 外西南', '碓磨床 外正西',
      '厨灶堂 外西北', '仓库门 外西北', '占房床 外正北',
      '占门厕 外东北', '碓磨栖 外东北', '厨灶床 外正东'
    ].freeze
    POSITION_TAI_MONTH = %w[占房床 占户窗 占门堂 占厨灶 占房床 占床仓 占碓磨 占厕户 占门房 占房床 占灶炉 占房床].freeze
    ZHI = ['', '子', '丑', '寅', '卯', '辰', '巳', '午', '未', '申', '酉', '戌', '亥'].freeze
    JIA_ZI = %w[甲子 乙丑 丙寅 丁卯 戊辰 己巳 庚午 辛未 壬申 癸酉 甲戌 乙亥 丙子 丁丑 戊寅 己卯 庚辰 辛巳 壬午 癸未 甲申 乙酉 丙戌 丁亥 戊子 己丑 庚寅 辛卯 壬辰 癸巳 甲午 乙未 丙申 丁酉 戊戌 己亥 庚子 辛丑 壬寅 癸卯 甲辰 乙巳 丙午 丁未 戊申 己酉 庚戌 辛亥 壬子 癸丑 甲寅 乙卯 丙辰 丁巳 戊午 己未 庚申 辛酉 壬戌 癸亥].freeze
    
    # 纳音
    NA_YIN = %w[海中金 海中金 炉中火 炉中火 大林木 大林木 路旁土 路旁土 剑锋金 剑锋金 山头火 山头火 涧下水 涧下水 城头土 城头土 白蜡金 白蜡金 杨柳木 杨柳木 泉中水 泉中水 屋上土 屋上土 霹雳火 霹雳火 松柏木 松柏木 长流水 长流水 沙中金 沙中金 山下火 山下火 平地木 平地木 壁上土 壁上土 金箔金 金箔金 覆灯火 覆灯火 天河水 天河水 大驿土 大驿土 钗钏金 钗钏金 桑柘木 桑柘木 大溪水 大溪水 沙中土 沙中土 天上火 天上火 石榴木 石榴木 大海水 大海水].freeze
    
    # 地支相冲
    ZHI_XING_CHONG = {
      '子' => ['午'],
      '丑' => ['未'],
      '寅' => ['申'],
      '卯' => ['酉'],
      '辰' => ['戌'],
      '巳' => ['亥'],
      '午' => ['子'],
      '未' => ['丑'],
      '申' => ['寅'],
      '酉' => ['卯'],
      '戌' => ['辰'],
      '亥' => ['巳']
    }.freeze
    
    # 天干相冲
    GAN_XING_CHONG = {
      '甲' => ['庚'],
      '乙' => ['辛'],
      '丙' => ['壬'],
      '丁' => ['癸'],
      '庚' => ['甲'],
      '辛' => ['乙'],
      '壬' => ['丙'],
      '癸' => ['丁']
    }.freeze
    
    # 地支相合
    ZHI_XING_HE = {
      '子' => ['丑'],
      '丑' => ['子'],
      '寅' => ['亥'],
      '卯' => ['戌'],
      '辰' => ['酉'],
      '巳' => ['申'],
      '午' => ['未'],
      '未' => ['午'],
      '申' => ['巳'],
      '酉' => ['辰'],
      '戌' => ['卯'],
      '亥' => ['寅']
    }.freeze
    
    # 天干相合
    GAN_XING_HE = {
      '甲' => ['己'],
      '乙' => ['庚'],
      '丙' => ['辛'],
      '丁' => ['壬'],
      '戊' => ['癸'],
      '己' => ['甲'],
      '庚' => ['乙'],
      '辛' => ['丙'],
      '壬' => ['丁'],
      '癸' => ['戊']
    }.freeze

    # 每月初一的天干偏移
    MONTH1_GAN_OFFSET = [0, 2, 4, 6, 8, 0, 2, 4, 6, 8].freeze
    
    # 每月初一的地支偏移
    MONTH1_ZHI_OFFSET = [0, 2, 4, 6, 8, 10, 0, 2, 4, 6, 8, 10].freeze
    
    # 每月生肖
    MONTH_ZHI = %w[寅 卯 辰 巳 午 未 申 酉 戌 亥 子 丑].freeze
    
    # 每月建
    MONTH_JIAN = %w[建 除 满 平 定 执 破 危 成 收 开 闭].freeze
    
    # 地支生肖
    ZHI_SHENG_XIAO = %w[鼠 牛 虎 兔 龙 蛇 马 羊 猴 鸡 狗 猪].freeze
    
    # 彭祖百忌天干
    PENG_ZU_GAN = [
      '甲不开仓财物耗散',
      '乙不栽植千株不长',
      '丙不修灶必见灾殃',
      '丁不剃头头必生疮',
      '戊不受田田主不祥',
      '己不破券二比并亡',
      '庚不经络织机虚张',
      '辛不合酱主人不尝',
      '壬不泱水更难提防',
      '癸不词讼理弱敌强'
    ].freeze
    
    # 彭祖百忌地支
    PENG_ZU_ZHI = [
      '子不问卜自惹祸殃',
      '丑不冠带主不还乡',
      '寅不祭祀神鬼不尝',
      '卯不穿井水泉不香',
      '辰不哭泣必主重丧',
      '巳不远行财物伏藏',
      '午不苫盖屋主更张',
      '未不服药毒气入肠',
      '申不安床鬼祟入房',
      '酉不会客醉坐颠狂',
      '戌不吃犬作怪上床',
      '亥不嫁娶不利新郎'
    ].freeze
    
    # 数字
    NUMBER = %w[〇 一 二 三 四 五 六 七 八 九].freeze
    
    # 月份
    MONTH = %w[正 二 三 四 五 六 七 八 九 十 冬 腊].freeze
    
    # 节气
    JIE = %w[小寒 立春 惊蛰 清明 立夏 芒种 小暑 立秋 白露 寒露 立冬 大雪].freeze
    
    # 中气
    QI = %w[冬至 大寒 雨水 春分 谷雨 小满 夏至 大暑 处暑 秋分 霜降 小雪].freeze
    
    # 节气和中气
    JIE_QI = %w[冬至 小寒 大寒 立春 雨水 惊蛰 春分 清明 谷雨 立夏 小满 芒种 夏至 小暑 大暑 立秋 处暑 白露 秋分 寒露 霜降 立冬 小雪 大雪].freeze
    
    # 节气偏移
    JIE_QI_OFFSET = [0, 21208, 43467, 63836, 85337, 107014, 128867, 150921, 173149, 195551, 218072, 240693, 263343, 285989, 308563, 331033, 353350, 375494, 397447, 419210, 440795, 462224, 483532, 504758].freeze

    # 方位描述
    POSITION_DESC = {
      '坎' => '正北',
      '艮' => '东北',
      '震' => '正东',
      '巽' => '东南',
      '离' => '正南',
      '坤' => '西南',
      '兑' => '正西',
      '乾' => '西北',
      '中' => '中央'
    }.freeze

    # Utility methods
    def self.get_gan(index)
      GAN[index % GAN.length]
    end

    def self.get_zhi(index)
      ZHI[index % ZHI.length]
    end

    def self.get_gan_index(gan)
      GAN.index(gan)
    end

    def self.get_zhi_index(zhi)
      ZHI.index(zhi)
    end

    def self.get_jia_zi_index(gan_zhi)
      JIA_ZI.index(gan_zhi)
    end

    def self.get_xun(gan_zhi)
      XUN[get_jia_zi_index(gan_zhi) / 10]
    end

    def self.get_xun_kong(gan_zhi)
      XUN_KONG[get_jia_zi_index(gan_zhi) / 10]
    end

    def self.find(name, names, offset)
      names.each_with_index do |n, i|
        return i + offset if n == name
      end
      -1
    end
  end
end